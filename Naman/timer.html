<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZenFocus Pro | 3D Timer & Music</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://www.youtube.com/iframe_api"></script>
    <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Lexend', sans-serif; background: #020617; overflow-x: hidden; }
        .glass {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .timer-card {
            transform-style: preserve-3d;
            perspective: 1000px;
            transition: transform 0.2s ease-out;
        }
        .glow-text { text-shadow: 0 0 20px rgba(129, 140, 248, 0.6); }
        .progress-ring { transform: rotate(-90deg); transition: stroke-dashoffset 0.4s cubic-bezier(0.4, 0, 0.2, 1); }
        [x-cloak] { display: none !important; }
        
        /* Hidden YT Player */
        #youtube-player { position: absolute; width: 0; height: 0; opacity: 0; pointer-events: none; }
    </style>
</head>
<body class="text-white min-h-screen flex items-center justify-center p-6">

    <div class="fixed inset-0 z-0">
        <div class="absolute top-[-10%] left-[-10%] w-[50%] h-[50%] bg-indigo-600/20 blur-[120px] rounded-full"></div>
        <div class="absolute bottom-[-10%] right-[-10%] w-[50%] h-[50%] bg-fuchsia-600/20 blur-[120px] rounded-full"></div>
    </div>

    <main x-data="pomodoroApp()" x-init="init()" x-cloak class="relative z-10 w-full max-w-lg">
        
        <div class="flex justify-between items-center mb-6">
            <h1 class="text-2xl font-bold bg-gradient-to-r from-indigo-400 to-fuchsia-400 bg-clip-text text-transparent">ZenFocus.</h1>
            <button @click="showSettings = !showSettings" class="glass p-3 rounded-2xl hover:bg-white/10 transition-all">
                <i data-lucide="settings-2" class="w-5 h-5"></i>
            </button>
        </div>

        <div class="timer-card glass rounded-[3rem] p-10 flex flex-col items-center shadow-2xl relative"
             @mousemove="handleTilt($event)" @mouseleave="resetTilt()">
            
            <div x-show="showSettings" x-transition.opacity class="absolute inset-0 z-20 glass rounded-[3rem] p-8 flex flex-col gap-4 backdrop-blur-2xl">
                <div class="flex justify-between items-center mb-2">
                    <h3 class="font-bold text-lg">Adjust Timers</h3>
                    <button @click="showSettings = false"><i data-lucide="x" class="w-5 h-5"></i></button>
                </div>
                
                <template x-for="m in modes">
                    <div class="flex items-center justify-between bg-white/5 p-3 rounded-2xl">
                        <span x-text="m.label" class="text-sm opacity-70"></span>
                        <div class="flex items-center gap-4">
                            <button @click="adjustDuration(m.name, -1)" class="w-8 h-8 rounded-lg bg-white/5 hover:bg-white/10">-</button>
                            <span x-text="m.time + 'm'" class="w-8 text-center font-bold"></span>
                            <button @click="adjustDuration(m.name, 1)" class="w-8 h-8 rounded-lg bg-white/5 hover:bg-white/10">+</button>
                        </div>
                    </div>
                </template>

                <hr class="border-white/10 my-2">
                
                <h3 class="font-bold text-lg">Atmosphere</h3>
                <input type="text" x-model="ytId" placeholder="YouTube Video ID (e.g. jfKfPfyJRdk)" 
                       class="w-full bg-white/5 border border-white/10 p-3 rounded-xl text-xs outline-none focus:border-indigo-500">
                
                <div class="flex items-center gap-3 mt-2">
                    <label class="text-xs opacity-60">Custom MP3:</label>
                    <input type="file" @change="handleFileUpload" class="text-xs text-gray-400 file:mr-4 file:py-1 file:px-4 file:rounded-full file:border-0 file:text-xs file:font-semibold file:bg-indigo-600 file:text-white hover:file:bg-indigo-700">
                </div>
            </div>

            <div class="flex p-1 bg-black/20 rounded-2xl mb-10 w-full">
                <template x-for="m in modes">
                    <button @click="setMode(m.name)"
                        :class="mode === m.name ? 'bg-white/10 text-white shadow-lg' : 'text-gray-500 hover:text-white'"
                        class="flex-1 py-2 px-3 rounded-xl text-xs font-bold transition-all"
                        x-text="m.label"></button>
                </template>
            </div>

            <div class="relative flex items-center justify-center w-64 h-64 mb-10">
                <svg class="w-full h-full progress-ring">
                    <circle cx="128" cy="128" r="115" stroke="rgba(255,255,255,0.03)" stroke-width="6" fill="transparent" />
                    <circle cx="128" cy="128" r="115" 
                        stroke="url(#timerGradient)" 
                        stroke-width="10" 
                        fill="transparent" 
                        stroke-linecap="round"
                        :stroke-dasharray="722"
                        :stroke-dashoffset="722 - (722 * progress / 100)" />
                    <defs>
                        <linearGradient id="timerGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" stop-color="#6366f1" />
                            <stop offset="100%" stop-color="#d946ef" />
                        </linearGradient>
                    </defs>
                </svg>

                <div class="absolute inset-0 flex flex-col items-center justify-center">
                    <span class="text-7xl font-extrabold tracking-tighter glow-text" x-text="formatTime()"></span>
                    <span class="text-xs uppercase tracking-[0.5em] text-indigo-400 mt-2 font-bold" x-text="mode"></span>
                </div>
            </div>

            <div class="flex items-center gap-8">
                <button @click="reset()" class="p-3 text-gray-500 hover:text-white transition-colors">
                    <i data-lucide="rotate-ccw"></i>
                </button>
                
                <button @click="toggle()" 
                    class="h-20 w-20 rounded-full flex items-center justify-center shadow-2xl transition-all active:scale-95 bg-white text-black hover:scale-105">
                    <i :data-lucide="isRunning ? 'pause' : 'play'" class="w-8 h-8 fill-current"></i>
                </button>

                <button @click="nextMode()" class="p-3 text-gray-500 hover:text-white transition-colors">
                    <i data-lucide="skip-forward"></i>
                </button>
            </div>
        </div>

        <div id="youtube-player"></div>
        <audio id="local-audio" loop></audio>
    </main>

    <script>
        let player; // YT Player variable

        function pomodoroApp() {
            return {
                mode: 'pomodoro',
                showSettings: false,
                isRunning: false,
                timeLeft: 1500,
                totalTime: 1500,
                ytId: 'jfKfPfyJRdk', // Default: Lofi Girl
                timer: null,
                modes: [
                    { name: 'pomodoro', label: 'FOCUS', time: 25 },
                    { name: 'shortBreak', label: 'REST', time: 5 },
                    { name: 'longBreak', label: 'BREAK', time: 15 }
                ],
                
                init() {
                    lucide.createIcons();
                    this.setMode('pomodoro');
                    // Initialize YT
                    window.onYouTubeIframeAPIReady = () => {
                        player = new YT.Player('youtube-player', {
                            height: '0', width: '0',
                            videoId: this.ytId,
                            events: { 'onReady': (e) => e.target.setVolume(50) }
                        });
                    };
                },

                handleTilt(e) {
                    const card = e.currentTarget;
                    const rect = card.getBoundingClientRect();
                    const x = e.clientX - rect.left;
                    const y = e.clientY - rect.top;
                    const centerX = rect.width / 2;
                    const centerY = rect.height / 2;
                    const rotateX = (y - centerY) / 15;
                    const rotateY = (centerX - x) / 15;
                    card.style.transform = `perspective(1000px) rotateX(${rotateX}deg) rotateY(${rotateY}deg)`;
                },

                resetTilt() {
                    const card = document.querySelector('.timer-card');
                    card.style.transform = `perspective(1000px) rotateX(0deg) rotateY(0deg)`;
                },

                adjustDuration(modeName, amount) {
                    const m = this.modes.find(i => i.name === modeName);
                    m.time = Math.max(1, m.time + amount);
                    if (this.mode === modeName && !this.isRunning) {
                        this.setMode(modeName);
                    }
                },

                setMode(m) {
                    this.mode = m;
                    this.isRunning = false;
                    clearInterval(this.timer);
                    const selected = this.modes.find(i => i.name === m);
                    this.timeLeft = selected.time * 60;
                    this.totalTime = this.timeLeft;
                    this.refreshIcons();
                    this.stopMusic();
                },

                get progress() {
                    return ((this.totalTime - this.timeLeft) / this.totalTime) * 100;
                },

                toggle() {
                    if (this.isRunning) {
                        clearInterval(this.timer);
                        this.stopMusic();
                    } else {
                        this.timer = setInterval(() => {
                            if (this.timeLeft > 0) this.timeLeft--;
                            else this.complete();
                        }, 1000);
                        this.playMusic();
                    }
                    this.isRunning = !this.isRunning;
                    this.refreshIcons();
                },

                playMusic() {
                    // Try YT first
                    if (player && player.playVideo && this.ytId) {
                        if(player.getVideoData().video_id !== this.ytId) {
                            player.loadVideoById(this.ytId);
                        }
                        player.playVideo();
                    }
                    // Try Local
                    const local = document.getElementById('local-audio');
                    if (local.src) local.play();
                },

                stopMusic() {
                    if (player && player.pauseVideo) player.pauseVideo();
                    const local = document.getElementById('local-audio');
                    local.pause();
                },

                handleFileUpload(e) {
                    const file = e.target.files[0];
                    if (file) {
                        const url = URL.createObjectURL(file);
                        document.getElementById('local-audio').src = url;
                        this.ytId = ''; // Clear YT if local file added
                    }
                },

                formatTime() {
                    const mins = Math.floor(this.timeLeft / 60);
                    const secs = this.timeLeft % 60;
                    return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
                },

                reset() { this.setMode(this.mode); },

                nextMode() {
                    const idx = this.modes.findIndex(m => m.name === this.mode);
                    this.setMode(this.modes[(idx + 1) % this.modes.length].name);
                },

                complete() {
                    clearInterval(this.timer);
                    this.isRunning = false;
                    this.stopMusic();
                    new Audio('https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3').play();
                    this.nextMode();
                },

                refreshIcons() { this.$nextTick(() => lucide.createIcons()); }
            }
        }
    </script>
</body>
</html>
